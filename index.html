<!doctype html>
<meta charset=utf-8>
<title>Visual: Demo</title>
<link rel=stylesheet href=visual.css>

<style>
html, body {
  height: 100%;
  margin: 0;
  overflow: hidden;
}
.buttons,
.palette {
  position: absolute;
  left: 0;
  border-right: 1px solid #bcbdbe;
  background: #e6e8e8;
}
.buttons {
  width: 190px;
  padding: 10px 0px 8px 10px;
  top: 0;
  height: 102px;
}
.buttons::before {
  content: '';
  position: absolute;
  bottom: 0;
  left: 10px;
  right: 10px;
  height: 1px;
  background: #bcbdbe;
  border-bottom: 1px solid #f2f2f2;
}
button {
  float: left;
  width: 85px;
  height: 18px;
  padding: 0;
  padding-left: 4px;
  border: 0;
  border-left: 7px solid;
  background: 0;
  margin: 0 10px 2px 0;
  outline: none;
  text-align: left;
}
button strong {
  font: 12px/18px Helvetica Neue, Helvetica, Arial, sans-serif;
  color: #8f9193;
}
button:hover strong {
  color: #fba939;
}
button.selected {
  background: currentColor;
}
button.selected strong {
  color: #fff;
  font-weight: bold;
}
.palette {
  width: 200px;
  top: 120px;
  bottom: 0;
}
.workspace {
  position: absolute;
  top: 0;
  left: 201px;
  right: 0;
  bottom: 0;
  background: #e0e0e0;
}
</style>

<body class=Visual-no-select>
<div class=buttons>
  <button value=1></button>
  <button value=5></button>
  <button value=2></button>
  <button value=6></button>
  <button value=3></button>
  <button value=7></button>
  <button value=4></button>
  <button value=8></button>
  <button value=9></button>
  <button value=10></button>
</div>
<div class=palette></div>
<div class=workspace></div>
<script src=visual.js></script>
<script>

'use strict';

var vis = Visual({
  categories: {
    0: ["undefined", '#d42828'],
    1: ["Motion", '#4a6cd4'],
    2: ["Looks", '#8a55d7'],
    3: ["Sound", '#bb42c3'],
    4: ["Pen", '#0e9a6c'], // Scratch 1.4: #009870
    5: ["Events", '#c88330'],
    6: ["Control", '#e1a91a'],
    7: ["Sensing", '#2ca5e2'],
    8: ["Operators", '#5cb712'],
    9: ["Data", '#ee7d16'], // Scratch 1.4: #f3761d
    10: ["More Blocks", '#632d99'], // #531e99
    11: ["Parameter", '#5947b1'],
    12: ["List", '#cc5b22'], // Scratch 1.4: #d94d11
    20: ["Exension", '#4b4a60'] // #72228c / #672d79
  },
  blocks: {
    // motion
    "forward:": ["c", "move %n steps", 1, 10],
    "turnRight:": ["c", "turn @turnRight %n degrees", 1, 15],
    "turnLeft:": ["c", "turn @turnLeft %n degrees", 1, 15],

    "heading:": ["c", "point in direction %d.direction", 1, 90],
    "pointTowards:": ["c", "point towards %m.spriteOrMouse", 1, ""],

    "gotoX:y:": ["c", "go to x:%n y:%n", 1],
    "gotoSpriteOrMouse:": ["c", "go to %m.spriteOrMouse", 1, "mouse-pointer"],
    "glideSecs:toX:y:elapsed:from:": ["c", "glide %n secs to x:%n y:%n", 1],

    "changeXposBy:": ["c", "change x by %n", 1, 10],
    "xpos:": ["c", "set x to %n", 1, 0],
    "changeYposBy:": ["c", "change y by %n", 1, 10],
    "ypos:": ["c", "set y to %n", 1, 0],

    "bounceOffEdge": ["c", "if on edge, bounce", 1],

    "setRotationStyle": ["c", "set rotation style %m.rotationStyle", 1, "left-right"],

    "xpos": ["r", "x position", 1],
    "ypos": ["r", "y position", 1],
    "heading": ["r", "direction", 1],

    // looks
    "say:duration:elapsed:from:": ["c", "say %s for %n secs", 2, "Hello!", 2],
    "say:": ["c", "say %s", 2, "Hello!"],
    "think:duration:elapsed:from:": ["c", "think %s for %n secs", 2, "Hmm...", 2],
    "think:": ["c", "think %s", 2, "Hmm..."],

    "show": ["c", "show", 2],
    "hide": ["c", "hide", 2],

    "lookLike:": ["c", "switch costume to %m.costume", 2, "costume1"],
    "nextCostume": ["c", "next costume", 2],
    "startScene": ["c", "switch backdrop to %m.backdrop", 2, "backdrop1"],

    "changeGraphicEffect:by:": ["c", "change %m.effect effect by %n", 2, "color", 25],
    "setGraphicEffect:to:": ["c", "set %m.effect effect to %n", 2, "color", 0],
    "filterReset": ["c", "clear graphic effects", 2],

    "changeSizeBy:": ["c", "change size by %n", 2, 10],
    "setSizeTo:": ["c", "set size to %n%", 2, 100],

    "comeToFront": ["c", "go to front", 2],
    "goBackByLayers:": ["c", "go back %n layers", 2, 1],

    "costumeIndex": ["r", "costume #", 2],
    "sceneName": ["r", "backdrop name", 2],
    "scale": ["r", "size", 2],

    // stage looks
    "startSceneAndWait": ["c", "switch backdrop to %m.backdrop and wait", 102, "backdrop1"],
    "nextScene": ["c", "next backdrop", 102],

    "backgroundIndex": ["r", "backdrop #", 102],

    // sound
    "playSound:": ["c", "play sound %m.sound", 3, "pop"],
    "doPlaySoundAndWait": ["c", "play sound %m.sound until done", 3, "pop"],
    "stopAllSounds": ["c", "stop all sounds", 3],

    "playDrum": ["c", "play drum %d.drum for %n beats", 3, 1, 0.25],
    "rest:elapsed:from:": ["c", "rest for %n beats", 3, 0.25],

    "noteOn:duration:elapsed:from:": ["c", "play note %d.note for %n beats", 3, 60, 0.5],
    "instrument:": ["c", "set instrument to %d.instrument", 3, 1],


    "changeVolumeBy:": ["c", "change volume by %n", 3, -10],
    "setVolumeTo:": ["c", "set volume to %n%", 3, 100],
    "volume": ["r", "volume", 3],

    "changeTempoBy:": ["c", "change tempo by %n", 3, 20],
    "setTempoTo:": ["c", "set tempo to %n bpm", 3, 60],
    "tempo": ["r", "tempo", 3],

    // pen
    "clearPenTrails": ["c", "clear", 4],

    "stampCostume": ["c", "stamp", 4],

    "putPenDown": ["c", "pen down", 4],
    "putPenUp": ["c", "pen up", 4],

    "penColor:": ["c", "set pen color to %c", 4],
    "changePenHueBy:": ["c", "change pen color by %n", 4],
    "setPenHueTo:": ["c", "set pen color to %n", 4, 0],

    "changePenShadeBy:": ["c", "change pen shade by %n", 4],
    "setPenShadeTo:": ["c", "set pen shade to %n", 4, 50],

    "changePenSizeBy:": ["c", "change pen size by %n", 4, 1],
    "penSize:": ["c", "set pen size to %n", 4, 1],

    // triggers
    "whenGreenFlag": ["h", "when @greenFlag clicked", 5],
    "whenKeyPressed": ["h", "when %m.key key pressed", 5, "space"],
    "whenClicked": ["h", "when this sprite clicked", 5],
    "whenSceneStarts": ["h", "when backdrop switches to %m.backdrop", 5, "backdrop1"],

    "whenSensorGreaterThan": ["h", "when %m.triggerSensor > %n", 5, "loudness", 10],

    "whenIReceive": ["h", "when I receive %m.broadcast", 5, ""],
    "broadcast:": ["c", "broadcast %m.broadcast", 5, ""],
    "doBroadcastAndWait": ["c", "broadcast %m.broadcast and wait", 5, ""],

    // control - sprite
    "wait:elapsed:from:": ["c", "wait %n secs", 6, 1],

    "doRepeat": ["c", "repeat %n %t", 6, 10],
    "doForever": ["f", "forever %t", 6],

    "doIf": ["c", "if %b then %t", 6],
    "doIfElse": ["c", "if %b then %t else %t", 6],
    "doWaitUntil": ["c", "wait until %b", 6],
    "doUntil": ["c", "repeat until %b %t", 6],

    "stopScripts": ["f", "stop %m.stop", 6, "all"],

    "whenCloned": ["h", "when I start as a clone", 6],
    "createCloneOf": ["c", "create clone of %m.spriteOnly", 6],
    "deleteClone": ["f", "delete this clone", 6],

    // sensing
    "touching:": ["b", "touching %m.touching?", 7, ""],
    "touchingColor:": ["b", "touching color %c?", 7],
    "color:sees:": ["b", "color %c is touching %c?", 7],
    "distanceTo:": ["r", "distance to %m.spriteOrMouse", 7, ""],

    "doAsk": ["c", "ask %s and wait", 7, "What's your name?"],
    "answer": ["r", "answer", 7],

    "keyPressed:": ["b", "key %m.key pressed?", 7, "space"],
    "mousePressed": ["b", "mouse down?", 7],
    "mouseX": ["r", "mouse x", 7],
    "mouseY": ["r", "mouse y", 7],

    "soundLevel": ["r", "loudness", 7],

    "senseVideoMotion": ["r", "video %m.videoMotionType on %m.stageOrThis", 7, "motion"],
    "setVideoState": ["c", "turn video %m.videoState", 7, "on"],
    "setVideoTransparency": ["c", "set video transparency to %n%", 7, 50],

    "timer": ["r", "timer", 7],
    "timerReset": ["c", "reset timer", 7],

    "getAttribute:of:": ["r", "%m.attribute of %m.spriteOrStage", 7],

    "timeAndDate": ["r", "current %m.timeAndDate", 7, "minute"],
    "timestamp": ["r", "days since 2000", 7],
    "getUserName": ["r", "username", 7],

    // operators
    "+": ["r", "%n + %n", 8, "", ""],
    "-": ["r", "%n - %n", 8, "", ""],
    "*": ["r", "%n * %n", 8, "", ""],
    "/": ["r", "%n / %n", 8, "", ""],

    "randomFrom:to:": ["r", "pick random %n to %n", 8, 1, 10],

    "<": ["b", "%s < %s", 8, "", ""],
    "=": ["b", "%s = %s", 8, "", ""],
    ">": ["b", "%s > %s", 8, "", ""],

    "&": ["b", "%b and %b", 8],
    "|": ["b", "%b or %b", 8],
    "not": ["b", "not %b", 8],

    "concatenate:with:": ["r", "join %s %s", 8, "hello ", "world"],
    "letter:of:": ["r", "letter %n of %s", 8, 1, "world"],
    "stringLength:": ["r", "length of %s", 8, "world"],

    "%": ["r", "%n mod %n", 8, "", ""],
    "rounded": ["r", "round %n", 8, ""],

    "computeFunction:of:": ["r", "%m.mathOp of %n", 8, "sqrt", 9],

    // variables
    "setVar": ["c", "set %m.var to %s", 9],
    "changeVar": ["c", "change %m.var by %n", 9],
    "showVariable:": ["c", "show variable %m.var", 9],
    "hideVariable:": ["c", "hide variable %m.var", 9],

    // lists
    "append:toList:": ["c", "add %s to %m.list", 12],

    "deleteLine:ofList:": ["c", "delete %d.listDeleteItem of %m.list", 12],
    "insert:at:ofList:": ["c", "insert %s at %d.listItem of %m.list", 12],
    "setLine:ofList:to:": ["c", "replace item %d.listItem of %m.list with %s", 12],

    "getLine:ofList:": ["r", "item %d.listItem of %m.list", 12],
    "lineCountOfList:": ["r", "length of %m.list", 12],
    "list:contains:": ["b", "%m.list contains %s", 12],

    "showList:": ["c", "show list %m.list", 12],
    "hideList:": ["c", "hide list %m.list", 12],

    // obsolete blocks from Scratch 1.4 that may be used in older projects
    "drum:duration:elapsed:from:": ["c", "play drum %n for %n beats", 98, 1, 0.25], // Scratch 1.4 MIDI drum
    "midiInstrument:": ["c", "set instrument to %n", 98, 1],
    "isLoud": ["b", "loud?", 98],

    // obsolete blocks from Scratch 1.4 that are converted to new forms (so should never appear):
    "abs": ["r", "abs %n", 98],
    "sqrt": ["r", "sqrt %n", 98],
    "doReturn": ["f", "stop script", 98],
    "stopAll": ["f", "stop all", 98],
    "showBackground:": ["c", "switch to background %m.costume", 98, "backdrop1"],
    "nextBackground": ["c", "next background", 98],
    "doForeverIf": ["f", "forever if %b %t", 98],

    // testing and experimental control prims
    "COUNT": ["r", "counter", 99],
    "CLR_COUNT": ["c", "clear counter", 99],
    "INCR_COUNT": ["c", "incr counter", 99],
    "doForLoop": ["c", "for each %m.varName in %s %t", 99, "v", 10],
    "doWhile": ["c", "while %b %t", 99],
    "warpSpeed": ["c", "all at once %t", 99],

    // stage motion (scrolling)
    "scrollRight": ["c", "scroll right %n", 99, 10],
    "scrollUp": ["c", "scroll up %n", 99, 10],
    "scrollAlign": ["c", "align scene %m.scrollAlign", 99, 'bottom-left'],
    "xScroll": ["r", "x scroll", 99],
    "yScroll": ["r", "y scroll", 99],

    // other obsolete blocks from alpha/beta
    "hideAll": ["c", "hide all sprites", 99],
    "getUserId": ["r", "user id", 99],
  },
  menus: {
    var: function() {
      return new vis.Menu('variable', 'another', vis.Menu.line, 'local')
    }
  }
});

var app = new vis.App();

var p = new vis.Palette(document.querySelector('.palette'));
app.add(p);

var categoryButton;
var buttons = {};
function switchPalette(category) {
  if (categoryButton) {
    categoryButton.className = '';
  }
  categoryButton = buttons[category];
  categoryButton.className = 'selected';
  p.clear();
  for (var name in vis.options.blocks) {
    if (vis.getBlock(name)[3] === +category) {
      p.add(new vis.Script().add(new vis.Block(name)));
    }
  }
}

function buttonClick() {
  switchPalette(this.value);
}

[].forEach.call(document.querySelectorAll('button'), function(b) {
  var cat = vis.getCategory(b.value);
  b.style.color = cat[2];
  b.innerHTML = '<strong>' + cat[1] + '</strong>';
  buttons[cat[0]] = b;
  b.addEventListener('click', buttonClick);
});

switchPalette(1);

var w = new vis.Workspace(document.querySelector('.workspace'));
app.add(w);

</script>
